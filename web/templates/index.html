<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CloudTerm — Secure Web Terminal</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512'%3E%3Cpath fill='%234d9fff' d='M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zM300 376c0 4.4-3.6 8-8 8h-84c-4.4 0-8-3.6-8-8v-32c0-4.4 3.6-8 8-8h84c4.4 0 8 3.6 8 8v32zm0-96c0 4.4-3.6 8-8 8h-84c-4.4 0-8-3.6-8-8v-32c0-4.4 3.6-8 8-8h84c4.4 0 8 3.6 8 8v32zm128 96c0 4.4-3.6 8-8 8h-84c-4.4 0-8-3.6-8-8v-32c0-4.4 3.6-8 8-8h84c4.4 0 8 3.6 8 8v32z'/%3E%3C/svg%3E">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/static/vendor/xterm/xterm.css">
<style>
:root {
  --bg:        #060911;
  --s1:        #0b0f17;
  --s2:        #111827;
  --s3:        #1a2235;
  --b1:        #1e2a3d;
  --b2:        #2d3f5c;
  --text:      #dce8ff;
  --muted:     #6b82a8;
  --dim:       #3a4d6b;
  --ssh:       #3ddc84;
  --ssh-dim:   rgba(61,220,132,0.1);
  --ssh-b:     rgba(61,220,132,0.28);
  --rdp:       #60a5fa;
  --rdp-dim:   rgba(96,165,250,0.1);
  --rdp-b:     rgba(96,165,250,0.28);
  --orange:    #fb923c;
  --orange-dim:rgba(251,146,60,0.1);
  --red:       #f87171;
  --yellow:    #fbbf24;
  --purple:    #a78bfa;
  --rhel:      #ee0000;
  --rhel-dim:  rgba(238,0,0,0.1);
  --tab-h:     38px;
  --topbar-h:  48px;
  --sidebar-w: 252px;
  --term-font-size: 12.5px;
}

* { margin:0; padding:0; box-sizing:border-box; }
html,body { height:100%; overflow:hidden; background:var(--bg); }

body {
  font-family: 'Lato', sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
}

/* ══ TOPBAR ══ */
.topbar {
  height: var(--topbar-h);
  background: var(--s1);
  border-bottom: 1px solid var(--b1);
  display: flex;
  align-items: center;
  padding: 0 16px;
  gap: 12px;
  flex-shrink: 0;
  z-index: 50;
}

/* ── Logo: cloud icon + CloudTerm + subtitle ── */
.brand {
  display: flex; align-items: center; gap: 10px;
  flex-shrink: 0;
}
.brand-icon {
  position: relative;
  width: 36px; height: 36px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.brand-icon .cloud-ico {
  position: absolute; width: 36px; height: 36px; fill: #58a6ff;
}
.brand-icon .term-ico {
  position: absolute; width: 16px; height: 16px;
  fill: none; stroke: var(--bg); stroke-width: 2.5;
  stroke-linecap: round; stroke-linejoin: round;
  z-index: 2; margin-top: 2px;
}
.brand-text {
  display: flex; flex-direction: column;
}
.brand-name {
  font-family: 'Lato', sans-serif;
  font-size: 15px; font-weight: 800;
  line-height: 1.1;
  background: linear-gradient(135deg, #58a6ff, #d2a8ff);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.brand-sub {
  font-size: 9px; color: var(--dim);
  letter-spacing: 0.3px;
  line-height: 1.3;
}

.topbar-right {
  margin-left: auto;
  display: flex; align-items: center; gap: 6px;
}
.scan-status {
  font-size:10px; color:var(--muted);
  display:flex; align-items:center; gap:5px;
  padding: 4px 10px;
  background: var(--s2);
  border: 1px solid var(--b1);
  border-radius: 20px;
}
.scan-dot {
  width:6px; height:6px; border-radius:50%;
  background: var(--ssh);
  box-shadow: 0 0 5px var(--ssh);
  animation: pulse 2.5s ease-in-out infinite;
}
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.3} }

.topbar-btn {
  width:30px; height:30px;
  background:var(--s2); border:1px solid var(--b1);
  border-radius:6px; color:var(--muted);
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; transition:all .2s;
  position: relative;
}
.topbar-btn:hover { background:var(--s3); color:var(--text); border-color:var(--b2); }
.topbar-btn .btn-tooltip {
  display:none; position:absolute; top:36px; right:0;
  background:var(--s2); border:1px solid var(--b2);
  border-radius:6px; padding:4px 8px; font-size:10px;
  color:var(--muted); white-space:nowrap; z-index:100;
  box-shadow: 0 4px 12px rgba(0,0,0,.4);
}
.topbar-btn:hover .btn-tooltip { display:block; }

/* Zoom buttons group */
.zoom-group {
  display:flex; align-items:center; gap:0;
  background:var(--s2); border:1px solid var(--b1);
  border-radius:6px; overflow:hidden;
}
.zoom-btn {
  width:26px; height:28px;
  background:none; border:none; color:var(--muted);
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; transition:all .15s;
  font-size:12px; font-family:'JetBrains Mono',monospace;
  font-weight:700;
}
.zoom-btn:hover { background:var(--s3); color:var(--text); }
.zoom-sep { width:1px; height:16px; background:var(--b1); }
.zoom-label {
  padding:0 6px; font-size:10px; color:var(--dim);
  min-width:32px; text-align:center;
}

/* ── Theme selector ── */
.theme-dropdown {
  position:relative;
}
.theme-dropdown-content {
  display:none; position:absolute; top:36px; right:0;
  background:var(--s2); border:1px solid var(--b2);
  border-radius:9px; padding:6px; min-width:200px;
  box-shadow:0 12px 40px rgba(0,0,0,.7); z-index:200;
}
.theme-dropdown.open .theme-dropdown-content { display:block; }
.theme-section-label {
  font-size:9px; color:var(--dim); padding:6px 8px 3px;
  text-transform:uppercase; letter-spacing:1px; font-weight:600;
}
.theme-opt {
  display:flex; align-items:center; gap:8px;
  padding:6px 10px; border-radius:6px; cursor:pointer;
  font-size:11px; color:var(--muted); transition:all .15s;
}
.theme-opt:hover { background:var(--s3); color:var(--text); }
.theme-opt.active { color:var(--text); background:rgba(108,92,231,.15); }
.theme-dot {
  width:12px; height:12px; border-radius:3px; flex-shrink:0;
  border:1px solid rgba(255,255,255,.1);
}
.theme-opt .check { margin-left:auto; font-size:10px; color:var(--ssh); }

/* ══ BODY LAYOUT ══ */
.body-layout {
  flex:1;
  display:grid;
  grid-template-columns: var(--sidebar-w) 1fr;
  column-gap:6px;
  overflow:hidden;
}

/* ══ SIDEBAR — STATIC WIDTH ══ */
.sidebar {
  width: var(--sidebar-w);
  min-width: var(--sidebar-w);
  max-width: var(--sidebar-w);
  background: var(--s1);
  border-right: 1px solid var(--b1);
  display:flex; flex-direction:column;
  overflow:hidden;
}
.sidebar-top {
  padding: 10px 10px 8px;
  border-bottom: 1px solid var(--b1);
}

/* ── Summary button ── */
.summary-btn {
  width:100%; display:flex; align-items:center; justify-content:center; gap:6px;
  padding:7px 0; margin-bottom:6px;
  background:var(--s2); border:1px solid var(--b1);
  border-radius:7px; color:var(--muted); font-size:11px;
  cursor:pointer; transition:all .2s; user-select:none;
}
.summary-btn:hover { border-color:var(--b2); color:var(--text); background:var(--s3); }
.summary-btn .summary-count {
  font-family:'Syne',sans-serif; font-weight:700; font-size:13px; color:var(--text);
}
/* ── Summary modal table ── */
.summary-table { width:100%; border-collapse:collapse; font-size:11px; margin:8px 0; }
.summary-table th { text-align:left; color:var(--muted); font-weight:600; padding:4px 6px; border-bottom:1px solid var(--b2); font-size:9px; text-transform:uppercase; letter-spacing:.5px; }
.summary-table td { padding:4px 6px; border-bottom:1px solid var(--b1); color:var(--text); }
.summary-table tr:last-child td { border-bottom:none; }
.summary-table .num { text-align:right; font-family:'JetBrains Mono',monospace; font-size:11px; }
.summary-total td { font-weight:700; border-top:2px solid var(--b2); }
.summary-section { font-size:10px; color:var(--dim); text-transform:uppercase; letter-spacing:1px; margin:12px 0 6px; font-weight:600; }
.platform-pills { display:flex; flex-wrap:wrap; gap:5px; margin:6px 0 10px; }
.platform-pill { background:var(--s3); border:1px solid var(--b1); border-radius:4px; padding:3px 8px; font-size:10px; color:var(--text); }
.platform-pill .pill-count { font-family:'JetBrains Mono',monospace; font-weight:700; margin-right:4px; }
.platform-pill .pill-label { color:var(--muted); }

/* ── Scan button ── */
.scan-btn {
  width:100%; display:flex; align-items:center; justify-content:center; gap:6px;
  padding:6px 0; margin-bottom:6px;
  background: linear-gradient(135deg, rgba(108,92,231,.15), rgba(96,165,250,.1));
  border:1px solid rgba(108,92,231,.3);
  border-radius:7px; cursor:pointer;
  font-family:'JetBrains Mono',monospace;
  font-size:10px; color:var(--purple);
  transition:all .2s;
}
.scan-btn:hover {
  background: linear-gradient(135deg, rgba(108,92,231,.25), rgba(96,165,250,.2));
  border-color:rgba(108,92,231,.5);
  color:var(--text);
}
.scan-btn svg { flex-shrink:0; }

.sidebar-search {
  display:flex; align-items:center; gap:6px;
  background:var(--s2); border:1px solid var(--b1);
  border-radius:7px; padding:0 9px; height:28px;
}
.sidebar-search input {
  background:none; border:none; outline:none;
  color:var(--text); font-family:'JetBrains Mono',monospace;
  font-size:11px; width:100%;
}
.sidebar-search input::placeholder { color:var(--dim); }

.tree { flex:1; overflow-y:auto; padding:6px 0; }
.tree::-webkit-scrollbar { width:3px; }
.tree::-webkit-scrollbar-thumb { background:var(--b1); border-radius:2px; }

/* tree nodes */
.t-account {
  display:flex; align-items:center; gap:6px;
  padding:7px 10px;
  font-size:10px; font-weight:700; color:var(--orange);
  cursor:pointer; user-select:none;
  transition:background .15s;
}
.t-account:hover { background:var(--orange-dim); }
.t-account .acc-id { font-family:'JetBrains Mono',monospace; }
.t-account .acc-badge {
  font-size:8px; background:rgba(251,146,60,.12);
  border:1px solid rgba(251,146,60,.25); color:var(--orange);
  border-radius:4px; padding:0px 4px; font-weight:400;
  flex-shrink:0;
}
.t-account .chev {
  margin-left:auto; color:var(--dim); font-size:9px;
  transition:transform .2s; flex-shrink:0;
}
.t-account.open .chev { transform:rotate(90deg); }

.t-region {
  display:flex; align-items:center; gap:6px;
  padding:5px 12px 5px 22px;
  font-size:10px; color:var(--muted); cursor:pointer;
  transition:all .15s; user-select:none;
}
.t-region:hover { color:var(--text); }
.t-region .rdot {
  width:5px; height:5px; border-radius:50%;
  background:var(--rdp); box-shadow:0 0 4px var(--rdp);
  flex-shrink:0;
}
.t-region .region-refresh {
  margin-left:auto; color:var(--dim); font-size:11px; cursor:pointer;
  opacity:0; transition:opacity .2s, transform .3s; flex-shrink:0;
}
.t-region:hover .region-refresh { opacity:1; }
.t-region .region-refresh.spinning { opacity:1; animation:spin .8s linear infinite; }
@keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
.t-region .chev {
  margin-left:4px; color:var(--dim); font-size:8px;
  transition:transform .2s; flex-shrink:0;
}
.t-region.open .chev { transform:rotate(90deg); }

.t-group {
  display:flex; align-items:center; cursor:pointer; user-select:none;
  padding:6px 12px 3px 28px;
  font-size:9px; color:var(--dim);
  text-transform:uppercase; letter-spacing:1.2px; font-weight:600;
}
.t-group:hover { color:var(--muted); }
.t-group .chev {
  margin-left:auto; color:var(--dim); font-size:7px;
  transition:transform .2s; flex-shrink:0;
}
.t-group.open .chev { transform:rotate(90deg); }

.t-inst {
  display:flex; align-items:center; gap:6px;
  padding:5px 10px 5px 34px;
  font-size:11px; color:var(--muted);
  cursor:pointer; user-select:none;
  border-left:2px solid transparent;
  transition:all .15s;
}
.t-inst:hover { color:var(--text); background:rgba(255,255,255,.03); border-left-color:var(--b2); }
.t-inst.active-ssh { color:var(--text); background:rgba(61,220,132,.06); border-left-color:var(--ssh); }
.t-inst.active-rdp { color:var(--text); background:rgba(96,165,250,.06); border-left-color:var(--rdp); }

.inst-info {
  flex: 1; min-width: 0;
  display: flex; flex-direction: column;
  line-height: 1.3;
}
.inst-name {
  overflow-wrap: break-word;
  word-break: break-all;
}
.inst-id {
  font-size: 9px;
  color: var(--dim);
  letter-spacing: 0.3px;
  opacity: 0.7;
}
.t-inst:hover .inst-id { opacity: 1; }

.sdot { width:6px; height:6px; border-radius:50%; flex-shrink:0; }
.sdot.run { background:var(--ssh); box-shadow:0 0 4px var(--ssh); }
.sdot.stop{ background:var(--red); }
.sdot.pend{ background:var(--yellow); }

/* OS icons — SVG-based for crisp rendering */
.os-ico { flex-shrink:0; width:14px; height:14px; display:flex; align-items:center; justify-content:center; }
.os-ico svg { width:12px; height:12px; }

/* ══ MAIN PANEL ══ */
.main {
  display:flex; flex-direction:column;
  overflow:hidden; background:var(--bg);
}

/* ── Tab bar ── */
.tab-bar {
  height: var(--tab-h);
  background: var(--s1);
  border-bottom: 1px solid var(--b1);
  display:flex; align-items:flex-end;
  padding: 0 8px;
  gap: 2px;
  flex-shrink:0;
  overflow-x:auto;
  overflow-y:hidden;
  scrollbar-width:none;
}
.tab-bar::-webkit-scrollbar { display:none; }

.tab {
  display:flex; align-items:center; gap:6px;
  padding: 0 12px;
  height: 32px;
  border-radius: 7px 7px 0 0;
  font-size:11px; cursor:pointer;
  background:var(--s2); border:1px solid var(--b1); border-bottom:none;
  color:var(--muted); white-space:nowrap; flex-shrink:0;
  transition:all .2s; user-select:none;
  position:relative; bottom:-1px;
}
.tab:hover { color:var(--text); background:var(--s3); }

.tab.active-ssh {
  background:var(--bg); border-color:var(--ssh-b);
  border-bottom-color:var(--bg);
  color:var(--text);
  box-shadow:0 -3px 10px rgba(61,220,132,.12);
}
.tab.active-rdp {
  background:var(--bg); border-color:var(--rdp-b);
  border-bottom-color:var(--bg);
  color:var(--text);
  box-shadow:0 -3px 10px rgba(96,165,250,.12);
}

.tab-type {
  font-size:9px; font-weight:700; border-radius:4px;
  padding:1px 5px; border:1px solid;
  line-height:1.4; letter-spacing:.4px;
}
.tab-type.ssh { background:var(--ssh-dim); border-color:var(--ssh-b); color:var(--ssh); }
.tab-type.rdp { background:var(--rdp-dim); border-color:var(--rdp-b); color:var(--rdp); }

.tab-close {
  width:14px; height:14px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-size:10px; color:var(--dim); transition:all .15s;
  flex-shrink:0;
}
.tab-close:hover { background:rgba(248,113,113,.2); color:var(--red); }



/* ── Panels ── */
.panels { flex:1; position:relative; overflow:hidden; }
.panel {
  position:absolute; inset:0;
  display:none; flex-direction:column;
}
.panel.visible { display:flex; }

/* ── SSH panel ── */
.ssh-panel {
  background: #020408;
  font-family:'JetBrains Mono',monospace;
}
.ssh-toolbar {
  display:flex; align-items:center; gap:8px;
  padding: 7px 14px;
  background: var(--s2);
  border-bottom: 1px solid var(--b1);
  flex-shrink:0;
}
.ssh-host-pill {
  display:flex; align-items:center; gap:6px;
  background:var(--ssh-dim); border:1px solid var(--ssh-b);
  border-radius:6px; padding:3px 10px;
  font-size:11px; color:var(--ssh);
}
.ssh-host-pill::before {
  content:''; width:6px; height:6px; border-radius:50%;
  background:var(--ssh); box-shadow:0 0 5px var(--ssh);
  animation:pulse 2s infinite;
}
.tool-btn {
  width:26px; height:26px;
  background:var(--s3); border:1px solid var(--b1);
  border-radius:5px; color:var(--muted);
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; font-size:11px; transition:all .15s;
}
.tool-btn:hover { border-color:var(--b2); color:var(--text); }
.tool-sep { width:1px; height:16px; background:var(--b1); margin:0 4px; }
.ssh-size { font-size:10px; color:var(--dim); margin-left:auto; }

/* xterm.js terminal container */
.terminal-container {
  flex:1; padding:0; overflow:hidden;
}
.terminal-container .xterm { height:100%; }
.xterm-viewport { scrollbar-width:thin; scrollbar-color:rgba(255,255,255,.12) transparent; }
.xterm-viewport::-webkit-scrollbar { width:4px; }
.xterm-viewport::-webkit-scrollbar-thumb { background:rgba(255,255,255,.12); border-radius:2px; }
.xterm-viewport::-webkit-scrollbar-track { background:transparent; }

.term-body {
  flex:1; padding:16px 20px;
  font-size: var(--term-font-size); line-height:2;
  overflow-y:auto;
}
.term-body::-webkit-scrollbar { width:3px; }
.term-body::-webkit-scrollbar-thumb { background:var(--b1); }

.tl { display:flex; align-items:baseline; gap:0; flex-wrap:wrap; }
.ps1-u { color:#7ec8e3; }
.ps1-at{ color:var(--dim); }
.ps1-h { color:var(--ssh); }
.ps1-sp{ color:var(--dim); }
.ps1-p { color:#c792ea; }
.ps1-d { color:var(--dim); }
.cmd   { color:var(--text); margin-left:8px; }
.out   { color:var(--muted); display:block; }
.out.g { color:var(--ssh); }
.out.r { color:var(--red); }
.out.y { color:var(--yellow); }
.cur   {
  display:inline-block; width:7px; height:13px;
  background:var(--text); animation:blink 1.1s step-end infinite;
  vertical-align:text-bottom; margin-left:8px;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }

.term-input-row {
  display:flex; align-items:center; gap:0;
  padding: 8px 20px;
  border-top: 1px solid var(--b1);
  background: var(--s1);
  flex-shrink:0;
}
.term-prompt { color:var(--ssh); font-size:12px; flex-shrink:0; }
.term-input {
  flex:1; background:none; border:none; outline:none;
  color:var(--text); font-family:'JetBrains Mono',monospace;
  font-size:12px; padding-left:8px; caret-color:var(--ssh);
}

/* ── RDP panel ── */
.rdp-panel { background:var(--bg); }
.rdp-toolbar {
  display:flex; align-items:center; gap:8px;
  padding:7px 14px;
  background:var(--s2); border-bottom:1px solid var(--b1);
  flex-shrink:0;
}
.rdp-host-pill {
  display:flex; align-items:center; gap:6px;
  background:var(--rdp-dim); border:1px solid var(--rdp-b);
  border-radius:6px; padding:3px 10px;
  font-size:11px; color:var(--rdp);
}
.rdp-host-pill::before {
  content:''; width:6px; height:6px; border-radius:50%;
  background:var(--rdp); box-shadow:0 0 5px var(--rdp);
  animation:pulse 2s infinite;
}
.rdp-res { font-size:10px; color:var(--dim); }

/* RDP resolution selector */
.rdp-res-select {
  background:var(--s3); border:1px solid var(--b1);
  border-radius:5px; color:var(--muted); font-family:'JetBrains Mono',monospace;
  font-size:10px; padding:2px 6px; cursor:pointer;
  outline:none;
}
.rdp-res-select option { background:var(--s2); color:var(--text); }

.rdp-viewport {
  flex:1; position:relative; overflow:hidden;
  background:#0a0a14;
}

/* guacamole display container */
.guac-display {
  width:100%; height:100%;
  position:relative; overflow:hidden;
}

.guac-label {
  position:absolute; top:8px; right:10px;
  font-size:9px; background:rgba(96,165,250,.12);
  border:1px solid rgba(96,165,250,.25); color:var(--rdp);
  border-radius:5px; padding:2px 8px;
}

/* ── Welcome / Empty state ── */
.welcome-panel {
  position:absolute; inset:0;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  gap:16px;
}
.welcome-panel.hidden { display:none; }
.welcome-icon {
  width:64px; height:64px;
  background: linear-gradient(135deg, rgba(108,92,231,.15), rgba(96,165,250,.1));
  border:1px solid rgba(108,92,231,.2);
  border-radius:16px;
  display:flex; align-items:center; justify-content:center;
}
.welcome-icon svg { width:32px; height:32px; fill:var(--dim); }
.welcome-title {
  font-family:'Syne',sans-serif; font-size:16px; font-weight:700;
  color:var(--muted);
}
.welcome-sub {
  font-size:11px; color:var(--dim); text-align:center;
  max-width:320px; line-height:1.6;
}
.welcome-hint {
  font-size:10px; color:var(--dim);
  background:var(--s2); border:1px solid var(--b1);
  border-radius:6px; padding:6px 14px;
  margin-top:8px;
}
.welcome-hint kbd {
  background:var(--s3); border:1px solid var(--b1);
  border-radius:3px; padding:1px 5px;
  font-family:'JetBrains Mono',monospace; font-size:10px;
  color:var(--muted);
}

/* ── Context menu ── */
.ctx-menu {
  position:fixed; z-index:200;
  background:var(--s2); border:1px solid var(--b2);
  border-radius:9px; padding:5px;
  box-shadow:0 12px 40px rgba(0,0,0,.7);
  min-width:180px; display:none;
}
.ctx-menu.show { display:block; }
.ctx-item {
  display:flex; align-items:center; gap:8px;
  padding:7px 12px; border-radius:6px;
  font-size:11px; color:var(--muted);
  cursor:pointer; transition:all .15s;
}
.ctx-item:hover { background:var(--s3); color:var(--text); }
.ctx-item .ico { font-size:12px; width:16px; text-align:center; }
.ctx-sep { height:1px; background:var(--b1); margin:3px 0; }
.ctx-item.danger { color:var(--red); }
.ctx-item.danger:hover { background:rgba(248,113,113,.1); }
.ctx-item .badge {
  margin-left:auto; font-size:9px; padding:1px 5px;
  border-radius:4px; border:1px solid;
}
.ctx-item .badge.ssh { background:var(--ssh-dim); border-color:var(--ssh-b); color:var(--ssh); }
.ctx-item .badge.rdp { background:var(--rdp-dim); border-color:var(--rdp-b); color:var(--rdp); }

/* ── New tab modal ── */
.modal-bg {
  position:fixed; inset:0; z-index:500;
  background:rgba(0,0,0,.6); backdrop-filter:blur(4px);
  display:none; align-items:center; justify-content:center;
}
.modal-bg.show { display:flex; }
.modal {
  background:var(--s2); border:1px solid var(--b2);
  border-radius:14px; padding:24px; width:520px; max-width:90vw;
  box-shadow:0 24px 80px rgba(0,0,0,.8);
  animation:popIn .25s cubic-bezier(.34,1.56,.64,1);
}
@keyframes popIn { from{transform:scale(.9);opacity:0} to{transform:scale(1);opacity:1} }
.modal-title {
  font-family:'Syne',sans-serif; font-size:16px; font-weight:700;
  margin-bottom:16px; color:var(--text);
}
.modal-choose {
  display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:16px;
}
.mc-btn {
  background:var(--s3); border:1px solid var(--b1);
  border-radius:10px; padding:16px; text-align:center;
  cursor:pointer; transition:all .2s;
}
.mc-btn:hover.ssh-c { border-color:var(--ssh-b); background:var(--ssh-dim); }
.mc-btn:hover.rdp-c { border-color:var(--rdp-b); background:var(--rdp-dim); }
.mc-btn .mc-ico { font-size:28px; margin-bottom:6px; }
.mc-btn .mc-name { font-size:12px; font-weight:700; }
.mc-btn .mc-sub  { font-size:10px; color:var(--dim); margin-top:2px; }
.mc-btn.ssh-c .mc-name { color:var(--ssh); }
.mc-btn.rdp-c .mc-name { color:var(--rdp); }
.modal-cancel {
  width:100%; padding:8px; background:none;
  border:1px solid var(--b1); border-radius:7px;
  color:var(--muted); font-family:'Lato',sans-serif;
  font-size:11px; cursor:pointer; transition:all .2s;
}
.modal-cancel:hover { border-color:var(--b2); color:var(--text); }
.det-row { display:grid; grid-template-columns:120px 1fr; padding:5px 0; border-bottom:1px solid var(--b1); font-size:11px; gap:8px; }
.det-label { color:var(--muted); }
.det-val { color:var(--text); text-align:left; word-break:break-all; }
.details-body { scrollbar-width:none; -ms-overflow-style:none; }
.details-body::-webkit-scrollbar { display:none; }

/* ── Status bar ── */
.statusbar {
  height:22px; background:var(--s1);
  border-top:1px solid var(--b1);
  display:flex; align-items:center;
  padding:0 12px; gap:14px;
  flex-shrink:0;
}
.sb-item {
  display:flex; align-items:center; gap:4px;
  font-size:10px; color:var(--dim);
}
.sb-item.ssh { color:var(--ssh); }
.sb-item.rdp { color:var(--rdp); }

/* ── Toast ── */
.toast {
  position:fixed; bottom:32px; right:20px; z-index:400;
  background:var(--s2); border:1px solid var(--b2);
  border-radius:10px; padding:10px 16px;
  display:flex; align-items:center; gap:10px;
  font-size:12px; color:var(--text);
  box-shadow:0 8px 32px rgba(0,0,0,.6);
  transform:translateY(100px); opacity:0;
  transition:all .3s cubic-bezier(.34,1.56,.64,1);
  pointer-events:none;
}
.toast.show { transform:translateY(0); opacity:1; }

/* ── Scanning spinner ── */
.scan-btn.scanning {
  pointer-events:none; opacity:.7;
}
.scan-btn.scanning svg {
  animation: spin 1s linear infinite;
}
@keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
</style>
</head>
<body>

<!-- Go template config passed from handler -->
<script>
  window.CLOUDTERM_CONFIG = {
    wsEndpoint:  "{{.WSEndpoint}}",
    rdpMode:     "{{.RDPMode}}",
    guacWSURL:   "{{.GuacWSURL}}"
  };
</script>

<!-- ══ TOPBAR ══ -->
<div class="topbar">
  <div class="brand">
    <div class="brand-icon">
      <svg class="cloud-ico" viewBox="0 0 640 512"><path d="M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4z"/></svg>
      <svg class="term-ico" viewBox="0 0 24 24"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
    </div>
    <div class="brand-text">
      <div class="brand-name">CloudTerm</div>
      <div class="brand-sub">Secure Web Terminal for AWS EC2 Instances via Systems Manager</div>
    </div>
  </div>

  <div class="topbar-right">
    <div class="scan-status" id="scanStatus"><div class="scan-dot" id="scanDot"></div><span id="scanText">Ready</span></div>

    <!-- Zoom controls -->
    <div class="zoom-group">
      <button class="zoom-btn" title="Zoom out" id="zoomOutBtn">&#x2212;</button>
      <div class="zoom-sep"></div>
      <span class="zoom-label" id="zoomLevel">100%</span>
      <div class="zoom-sep"></div>
      <button class="zoom-btn" title="Zoom in" id="zoomInBtn">+</button>
    </div>

    <!-- Theme selector -->
    <div class="theme-dropdown" id="themeDropdown">
      <button class="topbar-btn" title="Themes" id="themeToggleBtn">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"/><path d="M12 2a7 7 0 0 1 0 20"/></svg>
      </button>
      <div class="theme-dropdown-content">
        <div class="theme-section-label">Page Theme</div>
        <div class="theme-opt active" data-page-theme="dark"><div class="theme-dot" style="background:#060911"></div>Dark (Default)<span class="check">&#x2713;</span></div>
        <div class="theme-opt" data-page-theme="nord"><div class="theme-dot" style="background:#2e3440"></div>Nord</div>
        <div class="theme-opt" data-page-theme="dracula"><div class="theme-dot" style="background:#282a36"></div>Dracula</div>
        <div class="theme-opt" data-page-theme="light"><div class="theme-dot" style="background:#f5f5f5;border-color:#ccc"></div>Light</div>
        <div class="theme-section-label">Terminal Theme</div>
        <div class="theme-opt active" data-term-theme="github-dark"><div class="theme-dot" style="background:#0d1117"></div>GitHub Dark<span class="check">&#x2713;</span></div>
        <div class="theme-opt" data-term-theme="atom-one-dark"><div class="theme-dot" style="background:#282c34"></div>Atom One Dark</div>
        <div class="theme-opt" data-term-theme="nord"><div class="theme-dot" style="background:#2e3440"></div>Nord</div>
        <div class="theme-opt" data-term-theme="dracula"><div class="theme-dot" style="background:#282a36"></div>Dracula</div>
        <div class="theme-opt" data-term-theme="solarized-dark"><div class="theme-dot" style="background:#002b36"></div>Solarized Dark</div>
        <div class="theme-opt" data-term-theme="monokai"><div class="theme-dot" style="background:#272822"></div>Monokai</div>
      </div>
    </div>

  </div>
</div>

<!-- ══ BODY ══ -->
<div class="body-layout">

  <!-- ══ SIDEBAR (static width) ══ -->
  <div class="sidebar">
    <div class="sidebar-top">
      <!-- Summary button -->
      <div class="summary-btn" id="summaryBtn">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
        <span class="summary-count" id="statTotal">&mdash;</span> instances &middot; <span id="statAccounts">&mdash;</span> accounts
      </div>

      <!-- Scan button -->
      <div class="scan-btn" id="scanBtn">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
        Scan Instances
      </div>

      <!-- Filter -->
      <div class="sidebar-search">
        <svg width="10" height="10" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="filterInput" placeholder="Filter...">
      </div>
    </div>

    <!-- Tree container: populated by JS from /instances API -->
    <div class="tree" id="treeContainer"></div>
  </div>

  <!-- ══ MAIN ══ -->
  <div class="main">

    <!-- TAB BAR (empty, populated by JS) -->
    <div class="tab-bar" id="tabBar">
    </div>

    <!-- PANELS -->
    <div class="panels" id="panels">
      <!-- Welcome / empty state shown when no tabs are open -->
      <div class="welcome-panel" id="welcomePanel">
        <div class="welcome-icon">
          <svg viewBox="0 0 24 24"><path d="M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>
        </div>
        <div class="welcome-title">No active sessions</div>
        <div class="welcome-sub">Select an instance from the sidebar to start an SSH terminal or RDP session through AWS Systems Manager.</div>
        <div class="welcome-hint">Right-click an instance for more options</div>
      </div>
    </div>

    <!-- STATUS BAR -->
    <div class="statusbar">
      <div class="sb-item ssh">
        <svg width="9" height="9" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
        <span id="sshCount">0</span> SSH
      </div>
      <div class="sb-item rdp">
        <svg width="9" height="9" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2"/><polyline points="8 21 12 17 16 21"/></svg>
        <span id="rdpCount">0</span> RDP
      </div>
      <div class="sb-item" style="margin-left:auto">
        <span id="activeLabel" style="color:var(--dim)">No active session</span>
      </div>
      <div class="sb-item" id="activeInstanceId"></div>
      <div class="sb-item" id="activeRegion"></div>
    </div>
  </div>
</div>

<!-- CONTEXT MENU -->
<div class="ctx-menu" id="ctxMenu">
  <div class="ctx-item" data-action="ssh"><span class="ico"><svg width="12" height="12" viewBox="0 0 24 24" fill="#ee0000"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.1 0 2 .67 2 1.5S13.1 8 12 8s-2-.67-2-1.5S10.9 5 12 5zm4.5 12H7.5c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h9c.28 0 .5.22.5.5s-.22.5-.5.5zm.5-3H7c-.55 0-1-.45-1-1v-1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1v1c0 .55-.45 1-1 1z"/></svg></span>Open SSH Terminal<span class="badge ssh">SSH</span></div>
  <div class="ctx-item" data-action="rdp"><span class="ico"><svg width="12" height="12" viewBox="0 0 24 24" fill="#0078d4"><path d="M3 12V6.5l8-1.1V12H3zm0 .5h8v6.6l-8-1.1V12.5zM11.5 5.3l9.5-1.3v8h-9.5V5.3zM11.5 12.5H21v8l-9.5-1.3V12.5z"/></svg></span>Open RDP Session<span class="badge rdp">RDP</span></div>
  <div class="ctx-sep"></div>
  <div class="ctx-item" data-action="copy-id"><span class="ico">&#x2398;</span>Copy Instance ID</div>
  <div class="ctx-item" data-action="copy-ip"><span class="ico">&#x1F4E1;</span>Copy Private IP</div>
  <div class="ctx-sep"></div>
  <div class="ctx-item" data-action="details"><span class="ico">&#x2139;&#xFE0F;</span>Instance Details</div>
  <div class="ctx-sep"></div>
  <div class="ctx-item" data-action="upload"><span class="ico">&#x2B06;</span>Upload File</div>
  <div class="ctx-item" data-action="download"><span class="ico">&#x2B07;</span>Download File</div>
  <div class="ctx-sep"></div>
  <div class="ctx-item danger" data-action="close-all"><span class="ico">&#x2715;</span>Close All Sessions</div>
</div>

<!-- INSTANCE DETAILS MODAL -->
<div class="modal-bg" id="detailsModal">
  <div class="modal" style="width:560px;max-width:90vw">
    <div class="modal-title">Instance Details</div>
    <div class="details-body" style="max-height:60vh;overflow-y:auto"></div>
    <button class="modal-cancel" onclick="document.getElementById('detailsModal').classList.remove('show')">Close</button>
  </div>
</div>

<!-- FLEET SUMMARY MODAL -->
<div class="modal-bg" id="summaryModal">
  <div class="modal" style="width:620px;max-width:90vw">
    <div class="modal-title">Fleet Summary</div>
    <div id="summaryBody" class="details-body" style="max-height:65vh;overflow-y:auto"></div>
    <button class="modal-cancel" onclick="document.getElementById('summaryModal').classList.remove('show')">Close</button>
  </div>
</div>

<!-- UPLOAD FILE MODAL -->
<div class="modal-bg" id="uploadModal">
  <div class="modal" style="max-width:420px">
    <div class="modal-title">Upload File</div>
    <div id="uploadTarget" style="font-size:11px;color:var(--muted);margin-bottom:12px;"></div>
    <div id="uploadDropZone" style="border:2px dashed var(--b2);border-radius:10px;padding:30px;text-align:center;color:var(--dim);font-size:11px;cursor:pointer;margin-bottom:12px;">
      Drop file here or click to browse
      <input type="file" id="uploadFileInput" style="display:none">
    </div>
    <div id="uploadFileName" style="font-size:11px;color:var(--text);margin-bottom:8px;display:none;"></div>
    <input id="uploadRemotePath" type="text" placeholder="Remote path (e.g. /tmp/myfile.txt)" style="width:100%;box-sizing:border-box;padding:8px 10px;background:var(--s3);border:1px solid var(--b1);border-radius:7px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;margin-bottom:12px;">
    <div style="font-size:9px;color:var(--dim);margin-bottom:12px;">Large files transfer slowly via SSM (base64 chunked)</div>
    <div id="uploadProgress" style="display:none;margin-bottom:12px;">
      <div style="display:flex;align-items:center;gap:8px;">
        <div style="flex:1;background:var(--s3);border-radius:4px;height:6px;overflow:hidden;">
          <div id="uploadProgressBar" style="width:0%;height:100%;background:var(--ssh);transition:width .3s;"></div>
        </div>
        <span id="uploadProgressPct" style="font-size:10px;color:var(--muted);font-family:'JetBrains Mono',monospace;min-width:32px;text-align:right;">0%</span>
      </div>
      <div id="uploadProgressMsg" style="font-size:10px;color:var(--dim);margin-top:4px;"></div>
    </div>
    <div style="display:flex;gap:8px;">
      <button id="uploadBtn" disabled style="flex:1;padding:8px;background:linear-gradient(135deg,rgba(61,220,132,.2),rgba(108,92,231,.15));border:1px solid rgba(61,220,132,.4);border-radius:7px;color:var(--ssh);font-family:'Lato',sans-serif;font-size:11px;cursor:pointer;">Upload</button>
      <button class="modal-cancel" onclick="document.getElementById('uploadModal').classList.remove('show')" style="flex:1;">Cancel</button>
    </div>
  </div>
</div>

<!-- DOWNLOAD FILE MODAL -->
<div class="modal-bg" id="downloadModal">
  <div class="modal" style="max-width:420px">
    <div class="modal-title">Download File</div>
    <div id="downloadTarget" style="font-size:11px;color:var(--muted);margin-bottom:12px;"></div>
    <input id="downloadRemotePath" type="text" placeholder="Remote file path (e.g. /var/log/syslog)" style="width:100%;box-sizing:border-box;padding:8px 10px;background:var(--s3);border:1px solid var(--b1);border-radius:7px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;margin-bottom:12px;">
    <div id="downloadProgress" style="display:none;margin-bottom:12px;">
      <div style="display:flex;align-items:center;gap:8px;">
        <div style="flex:1;background:var(--s3);border-radius:4px;height:6px;overflow:hidden;">
          <div id="downloadProgressBar" style="width:0%;height:100%;background:var(--rdp);transition:width .3s;"></div>
        </div>
        <span id="downloadProgressPct" style="font-size:10px;color:var(--muted);font-family:'JetBrains Mono',monospace;min-width:32px;text-align:right;">0%</span>
      </div>
      <div id="downloadProgressMsg" style="font-size:10px;color:var(--dim);margin-top:4px;"></div>
    </div>
    <div style="display:flex;gap:8px;">
      <button id="downloadBtn" style="flex:1;padding:8px;background:linear-gradient(135deg,rgba(96,165,250,.2),rgba(108,92,231,.15));border:1px solid rgba(96,165,250,.4);border-radius:7px;color:var(--rdp);font-family:'Lato',sans-serif;font-size:11px;cursor:pointer;">Download</button>
      <button class="modal-cancel" onclick="document.getElementById('downloadModal').classList.remove('show')" style="flex:1;">Cancel</button>
    </div>
  </div>
</div>


<!-- TOAST -->
<div class="toast" id="toast"><span id="toastMsg"></span></div>

<!-- Vendor scripts -->
<script src="/static/vendor/xterm/xterm.js"></script>
<script src="/static/vendor/xterm/xterm-addon-fit.js"></script>
<script src="/static/vendor/xterm/xterm-addon-web-links.js"></script>
<!-- Application -->
<script src="/static/js/app.js"></script>
</body>
</html>
